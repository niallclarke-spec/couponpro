<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>CodeTag Admin</title>
    <style>
      html,body { height: 100%; margin: 0; }
      body {
        background: #0b0c10;
        color: #e9eef5;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      }
      header {
        padding: 18px 20px;
        background: #0b0c10;
        border-bottom: 1px solid #262b35;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      header h1 {
        margin: 0;
        font-weight: 800;
        font-size: 18px;
      }
      header p {
        margin: 6px 0 0;
        color: #9aa3ad;
        font-size: 13px;
      }
      header img.logo { height:28px; }
      .cms-root {
        height: calc(100% - 70px);
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <header>
      <img src="../assets/fp-site-logo.png" alt="FunderPro Logo" class="logo" />
      <div>
        <h1>CodeTag Admin</h1>
        <p>Manage templates and upload promo images.</p>
      </div>
    </header>

    <!-- Decap CMS mounts here -->
    <div id="nc-root" class="cms-root"></div>

    <script src="https://unpkg.com/decap-cms@^3.3.0/dist/decap-cms.js"></script>

    <script>
      // Inline Decap config so we don't rely on /admin/config.yml being served
      window.CMS_MANUAL_INIT = true;

      (function () {
        const config = {
          backend: {
            name: "github",
            repo: "niallclarke-spec/couponpro",
            branch: "main",
            base_url: "https://couponpro-o4fjo.ondigitalocean.app",
            auth_endpoint: "/auth"
          },
          media_folder: "assets/uploads",
          public_folder: "/assets/uploads",
          media_library: { name: "git" },
          collections: [
            {
              name: "uploads",
              label: "Uploads",
              label_singular: "Upload",
              description: "Simple media uploads into assets/uploads",
              files: [
                {
                  file: "assets/uploads/.keep",
                  label: "Upload Media",
                  name: "media",
                  fields: [
                    { label: "Upload files", name: "files", widget: "file", multiple: true, allow_multiple: true }
                  ]
                }
              ]
            }
          ]
        };

        function start() {
          if (window.CMS && window.CMS.init) {
            window.CMS.init({ config });
          } else {
            setTimeout(start, 50);
          }
        }

        start();
      })();
    </script>
  </body>
</html>